  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <title>Clayton Campus Bike Availability</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
          integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Vega -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <!-- d3 -->
    <script src="https://unpkg.com/d3@7/dist/d3.min.js"></script>

    <style>
      body { padding: 1rem; font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: url('bicycle_header.png'); background-repeat: no-repeat; background-size: 100%; background-position: top 0 center;}
      h1 { text-align: center; font-size: 2rem; font-weight: 700; color: #034e7b; margin-bottom: 0.75rem; }
      .intro { margin: 0 auto 1.5rem auto; max-width: 960px; font-size: 1rem; line-height: 1.6; color: #333; text-align: center; }
      #map-internal { height: 480px; margin-bottom: 24px; background: #f8f9fb; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
      .charts { display: grid; grid-template-columns: 1fr; gap: 24px; }
      @media (min-width: 1100px) { .charts { grid-template-columns: 1fr 1fr; } }
      .chart { min-height: 500px; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 2rem; display: flex; flex-direction: column; align-items: center; }
      .chart > h2 { margin: 0; }
      .chart.wide { grid-column: 1 / -1; }
    </style>
  </head>
  <body>
    <h1>Clayton Campus Bike Availability</h1>

    <div class="intro">
      <p>Prepared by <strong>Matthew Sastra Surya (ID: 34393021)</strong>, published on 20/10/2025.</p>
      <p>Parking data captured from <a href="https://www.openstreetmap.org/about">OpenStreetMap</a> via <a href="https://www.overpass-turbo.eu">Overpass-Turbo</a> on 08/10/2025.</p>
    </div>

    <div class="intro">
      Cycling is one of the most sustainable and efficient ways to move around urban areas.
      At Monash University’s Clayton campus, bike use helps reduce traffic congestion,
      lower carbon emissions, and promote healthier lifestyles among students and staff.
      The university supports this through well-distributed bike parking zones, lighting for safety at night,
      and access options suited to different users. The map below shows the spatial distribution of bike parking
      availability across the Clayton campus, helping cyclists find convenient and secure places to park their bikes.
    </div>

    <form id="filter" class="pure-form pure-form-aligned pure-g">
      <fieldset class="pure-u-1-2">
        <h3>Filter Map Data</h3>
        <div class="pure-control-group">
          <label for="filter-parking-type">Parking Type</label>
          <select id="filter-parking-type" class="pure-input-1-4">
            <option value="all">All Types</option>
            <option value="stands">Bike Stands/Racks</option>
            <option value="shed">Bike Shed</option>
            <option value="building">Indoor Bike Stations</option>
          </select>
        </div>
        
        <div class="pure-control-group">
          <label for="filter-parking-access">Parking Access</label>
          <select id="filter-parking-access" class="pure-input-1-4">
            <option value="all">All Access Types</option>
            <option value="nil">Open</option>
            <option value="permit">Permit</option>
            <option value="residents">Residents</option>
          </select>
        </div>

        <div class="pure-controls">
          <label for="filter-is-lit" class="pure-checkbox">
            <input id="filter-is-lit" type="checkbox"> Lit during night
          </label>
        </div>
      </fieldset>
      <fieldset class="pure-u-1-2">
        <h3>Legend</h3>
        <p>The color shades are based on how many bikes each area can park.</p>
        <ul>
          <li><div style="background-color: #034e7b; display: inline-block; height: 1rem; width: 1rem;"></div> &ge;12.5% (of the overall total capacity in Clayton campus)</li>
          <li><div style="background-color: #0570b0; display: inline-block; height: 1rem; width: 1rem;"></div> 10.0-12.5%</li>
          <li><div style="background-color: #3690c0; display: inline-block; height: 1rem; width: 1rem;"></div> 7.5-10.0%</li>
          <li><div style="background-color: #74a9cf; display: inline-block; height: 1rem; width: 1rem;"></div> 5.0-7.5%</li>
          <li><div style="background-color: #a6bddb; display: inline-block; height: 1rem; width: 1rem;"></div> 2.5-5.0%</li>
          <li><div style="background-color: #d0d1e6; display: inline-block; height: 1rem; width: 1rem;"></div> &lt;2.5%</li>
          <li><div style="background-color: #f1eef6; display: inline-block; height: 1rem; width: 1rem;"></div> No data</li>
        </ul>
        <p>Click on each segment to reveal the numbers.</p>
      </fieldset>
    </form>

    <div id="map-internal"></div>

    <div class="charts">
      <div class="chart">
        <h2>Chart of Lit</h2>
        <p>Lighting plays a key role in making bike parking safe and convenient at night. Well-lit areas help people returning late find and unlock their bikes more easily while feeling secure. This chart highlights how lighting affects accessibility and comfort for cyclists who rely on these facilities after dark.</p>
        <div id="lights-chart"></div>
      </div>

      <div class="chart">
        <h2>Chart of Access Type</h2>
        <p>Most bike parking areas are open for general use, while only a small share requires special access such as permits or residential permission. This setup makes parking more flexible and convenient for everyday cyclists, encouraging more people to ride without worrying about restrictions or access limitations.</p>
        <div id="access-donut"></div>
      </div>

      <div class="chart wide">
        <h2>Chart of Parking Availabality by Direction</h2>
        <p>Capacity clusters in the east and central zones. The north‑east holds the most spaces (444), followed by middle‑central (381) and north‑central (373). Western zones are light, especially the south‑west (36) and north‑west (52). Use this to guide where you look for a spot at busy times. Boundaries: W1 Car Park, Scenic Boulevard, and Monash College or John Monash Science School.</p>
        <div id="capacity-matrix"></div>
      </div>
  

      <div class="chart">
        <h2>Capacity Distribution of Parking spot by Group of Faculty</h2>
        <p>This chart shows how bike parking capacity is spread across groups and faculties. Each circle is a location. Position to the right means more spaces per location. Larger circles mean higher capacity. Colors show whether access is open, permit, residents, or other. Most locations sit in the mid range, with a few high‑capacity hubs. Use the larger circles on the right to find easier parking during busy times.</p>
        <div id="parking-distribution"></div>
      </div>

      <div class="chart">
        <h2>Chart of Campus Area</h2>
        <p>This donut chart shows how bike parking capacity is split across faculties and key sites. Larger segments mean more spaces. You can spot where capacity is concentrated and which areas contribute less. Use the biggest segments to decide where to look first for a spot or where to target upgrades.</p>
        <div id="capacity-bubble"></div>
      </div>

    </div>

    <script>
      /* ===== Map ===== */
      function getColorShade(s){ if(s>=.125)return"#034e7b"; if(s>=.1)return"#0570b0"; if(s>=.075)return"#3690c0"; if(s>=.05)return"#74a9cf"; if(s>=.025)return"#a6bddb"; if(s>0)return"#d0d1e6"; return"#f1eef6"; }

      function styleGroup(f,agg){
        const els=document.getElementById("filter").elements;
        const isLit=els.namedItem("filter-is-lit").checked;
        const pType=els.namedItem("filter-parking-type").value;
        const acc=els.namedItem("filter-parking-access").value;
        let grand=0, total=0;
        agg.forEach(r=>{
          if(isLit && r.lit!=="yes") return;
          if(pType!=="all" && r.bicycle_parking!==pType) return;
          if(acc!=="all" && r.access!==acc) return;
          grand+=Number(r.total_capacity);
          if(r.group!==f.properties.group) return;
          total+=Number(r.total_capacity);
        });
        return { fillColor:getColorShade(grand? total/grand:0), weight:2, opacity:1, fillOpacity:.7, color:"#034e7b", dashArray:"3" };
      }

      (async function(){
        try{
          const map=L.map("map-internal").setView([-37.909,145.136],15);
          L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);
          const [groups, agg]=await Promise.all([fetch("monash-clayton-groups.json").then(r=>r.json()), d3.csv("bike-data-per-group.csv")]);
          const layer=L.geoJson(groups,{
            onEachFeature:(f,l)=>{
              l.on("click", ()=>{
                const els=document.getElementById("filter").elements;
                const isLit=els.namedItem("filter-is-lit").checked;
                const pType=els.namedItem("filter-parking-type").value;
                const acc=els.namedItem("filter-parking-access").value;
                let totC=0, totL=0, gC=0, gL=0;
                agg.forEach(r=>{
                  if(isLit && r.lit!=="yes") return;
                  if(pType!=="all" && r.bicycle_parking!==pType) return;
                  if(acc!=="all" && r.access!==acc) return;
                  gC+=Number(r.total_capacity); gL+=Number(r.total_locations);
                  if(r.group!==f.properties.group) return;
                  totC+=Number(r.total_capacity); totL+=Number(r.total_locations);
                });
                l.bindPopup(`<h4>${f.properties.name}</h4><p>Total parking spots: ${totL} (out of ${gL})</p><p>Total capacity: ${totC} bikes (out of ${gC})</p>`).openPopup();
              });
            },
            style:(f)=>styleGroup(f,agg)
          }).addTo(map);
          document.getElementById("filter").addEventListener("change", ()=>layer.resetStyle());
        }catch(e){console.error("Map failed:",e);}
      })();

      /* ===== Inline Matrix Chart ===== */
      const matrixSpec = {
        "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
        "description":"3x3 matrix showing total availabality by latitude × longtitude",
        "width":500,"height":420,
        "data":{"url":"bike-data-original.csv","format":{"type":"csv"}},
        "transform":[
          {"calculate":"datum.lat > -37.910 ? 'North' : datum.lat > -37.913 ? 'Middle' : 'South'","as":"Latitude"},
          {"calculate":"datum.lon < 145.131 ? 'West' : datum.lon < 145.134 ? 'Central' : 'East'","as":"Longitude"},
          {"calculate":"datum.capacity === 'nil' ? 0 : toNumber(datum.capacity || 0)","as":"cap_num"},
          {"aggregate":[{"op":"sum","field":"cap_num","as":"cap_sum"}],"groupby":["Latitude","Longitude"]},
          {"impute":"cap_sum","key":"Latitude","groupby":["Longitude"],"method":"value","value":0},
          {"impute":"cap_sum","key":"Longitude","groupby":["Latitude"],"method":"value","value":0},
          {"filter":"indexof(['West','Central','East'], datum.Longitude) >= 0"},
          {"filter":"indexof(['North','Middle','South'], datum.Latitude) >= 0"}
        ],
        "layer":[
          {"mark":"rect","encoding":{
            "x":{"field":"Longitude","type":"nominal","title":"Longitude","sort":["West","Central","East"]},
            "y":{"field":"Latitude","type":"nominal","title":"Latitude","sort":["North","Middle","South"]},
            "color":{"field":"cap_sum","type":"quantitative","title":"Total Capacity","scale":{"scheme":"blues"}},
            "tooltip":[{"field":"Latitude"},{"field":"Longitude"},{"field":"cap_sum","type":"quantitative","title":"Total Capacity"}]
          }},
          {"mark":{"type":"text","baseline":"middle","align":"center"},
          "encoding":{
            "x":{"field":"Longitude","type":"nominal","sort":["West","Central","East"]},
            "y":{"field":"Latitude","type":"nominal","sort":["North","Middle","South"]},
            "text":{"field":"cap_sum","type":"quantitative","format":".0f"},
            "color":{"condition":{"test":"datum.cap_sum > 600","value":"white"},"value":"black"}
          }}
        ],
        "title":{"text":"Capacity Matrix (Latitude × Longtitude)","fontSize":16,"fontWeight":"bold","anchor":"middle"}
      };

      /* ===== Load External Charts + Matrix Inline ===== */
      (async function loadCharts(){
        try{ await vegaEmbed("#capacity-matrix", matrixSpec, { actions:false }); }catch(e){ console.error("Matrix failed:", e); }

        const charts = [
          ["#lights-chart", "bar_chart.json"],
          ["#access-donut", "access_donut.json"],
          ["#parking-distribution", "parking_distribution.json"],
          // ["#capacity-bubble", "capacity_bubble.json"],
          ["#capacity-bubble", "campus_or_faculty_donut.json"]
        ];
        for (const [sel, file] of charts){
          try{ await vegaEmbed(sel, file, { actions:false }); }
          catch(e){ console.error(`Failed to load ${file}:`, e); }
        }
      })();
    </script>
  </body>
  </html>
